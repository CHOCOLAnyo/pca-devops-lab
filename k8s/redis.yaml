# ----------------------------------------------------------
# 標題：Redis 資料庫配置檔
# 功能：提供應用程式快取與資料儲存，並確保與 App 處於同一隔離空間
# ----------------------------------------------------------

# ----------------------------------------------------------
# 區塊一：定義資料庫的內部通訊錄 (Service)
# ----------------------------------------------------------
apiVersion: v1                  # [固定] K8s API版本
kind: Service                   # [固定] 資源類型
metadata:                       # [固定] 元數據區塊
  name: redis-service           # [自訂] 服務名稱 / [關鍵連動] 對應 App 的 REDIS_HOST
  namespace: pca-app-ns         # [自訂] 確保資料庫跟 App 住在同一個 Namespace
spec:                           # [固定] 規格說明書
  ports:                        # [固定] 通訊埠設定
    - port: 6379                # [參數] 服務端口
  selector:                     # [固定] 標籤選擇器
    app: redis                  # [自訂] 標籤名稱

---
# ----------------------------------------------------------
# 區塊二：定義資料庫的實體 (Deployment)
# ----------------------------------------------------------
apiVersion: apps/v1             # [固定] K8s API版本
kind: Deployment                # [固定] 資源類型
metadata:                       # [固定] 元數據區塊
  name: redis-deployment        # [自訂] 部署名稱
  namespace: pca-app-ns         # [自訂] 確保實體 Pod 也在正確的隔離空間
spec:                           # [固定] 規格說明書
  replicas: 1                   # [參數] 副本數量 (單機版資料庫)
  selector:                     # [固定] 標籤選擇器
    matchLabels:                # [固定] 匹配模式
      app: redis                # [自訂] 標籤名稱
  template:                     # [固定] Pod 模具
    metadata:                   # [固定] Pod 元數據
      labels:                   # [固定] 標籤設定
        app: redis              # [自訂] 標籤名稱
    spec:                       # [固定] Pod 規格
      containers:               # [固定] 容器列表
        - name: redis           # [自訂] 容器名稱
          image: redis:alpine   # [參數] 映像檔來源 / [參數] 使用輕量版 OS**
          ports:                # [固定] 容器埠口設定
            - containerPort: 6379 # [參數] 容器內埠口