#devops-exam/Dockerfile
# -----------------------------------------------------------
# 1. 選擇Base Image
# -----------------------------------------------------------
# 使用slim版的 Python 3.9 體積小，下載快
FROM python:3.9-slim

# -----------------------------------------------------------
# 2. 設定工作目錄 (Work Directory)
# -----------------------------------------------------------
# 就像在 Linux 裡面下指令 "cd /app"
# 接下來所有的動作，都會在這個 /app 資料夾裡面發生
WORKDIR /app

# -----------------------------------------------------------
# 3. 搬運需求清單
# -----------------------------------------------------------
# 先把 requirements.txt 單獨搬進去
# 目的：只要清單沒變，Docker 就會用快取跳過下一步的安裝，加速打包
COPY requirements.txt .

# -----------------------------------------------------------
# 4. 安裝依賴套件 (Install Dependencies)
# -----------------------------------------------------------
# 根據清單安裝 Flask 和 Redis
# --no-cache-dir 是為了不存暫存檔，讓映像檔更輕量
RUN pip install --no-cache-dir -r requirements.txt

# -----------------------------------------------------------
# 5. 搬運主程式 (Copy Source Code)
# -----------------------------------------------------------
# 這裡才把 app.py (以及其他所有檔案) 搬進去
# 因為程式碼常改，所以放在最後面，避免影響上面安裝套件的快取
COPY . .

# -----------------------------------------------------------
# 6. 宣告埠口 (Expose Port)
# -----------------------------------------------------------
# 告訴使用這個映像檔的人：這支程式預計會開在 5000 Port
# (這主要是寫給人看的，實際對外開放要在啟動時設定)
EXPOSE 5000

# -----------------------------------------------------------
# 7. 啟動指令 (Startup Command)
# -----------------------------------------------------------
# 當容器被啟動 (run) 的時候，自動執行這行指令
CMD ["python", "app.py"]